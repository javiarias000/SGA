{% extends 'classes/base_student.html' %}

{% block title %}Mis Clases{% endblock %}

{% block content %}
<h1 class="page-title">📚 Mis Clases</h1>
<p class="page-subtitle">Historial completo de clases de música</p>

<!-- FILTRO -->
<div style="margin-bottom: 30px;">
    <form method="get" style="display: flex; gap: 15px; flex-wrap: wrap;">
        <select name="subject" class="form-control" style="max-width: 300px; padding: 12px; border: 2px solid #D1D5DB; border-radius: 10px;" onchange="this.form.submit()">
            <option value="">Todas las materias</option>
            {% for subject in student.get_subjects %}
                <option value="{{ subject }}" {% if subject_filter == subject %}selected{% endif %}>{{ subject }}</option>
            {% endfor %}
        </select>
    </form>
</div>

<!-- CLASES AGRUPADAS POR MATERIA -->
{% for subject, subject_activities in activities_by_subject.items %}
<div style="margin-bottom: 40px;">
    <h2 style="color: #1F2937; font-size: 1.5em; margin-bottom: 20px;">
        {% if 'Guitarra' in subject %}🎸{% elif 'Conjunto' in subject %}🎺{% else %}🎵{% endif %}
        {{ subject }} ({{ subject_activities|length }} clases)
    </h2>
    
    {% for activity in subject_activities %}
    <div style="background: white; border: 2px solid #E5E7EB; padding: 20px; border-radius: 12px; margin-bottom: 15px;">
        <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 15px;">
            <div>
                <h3 style="color: #1F2937; margin-bottom: 5px;">Clase #{{ activity.class_number }}</h3>
                <p style="color: #6B7280; font-size: 0.9em;">{{ activity.date|date:"d F Y" }}</p>
            </div>
            <span style="padding: 8px 16px; border-radius: 20px; font-weight: bold; font-size: 0.9em;
                {% if activity.performance == 'Excelente' %}background: #D1FAE5; color: #065F46;
                {% elif activity.performance == 'Muy Bueno' or activity.performance == 'Bueno' %}background: #FEF3C7; color: #92400E;
                {% else %}background: #FED7AA; color: #9A3412;{% endif %}">
                {{ activity.performance }}
            </span>
        </div>
        
        <div style="background: #F9FAFB; padding: 15px; border-radius: 10px;">
            <p style="margin-bottom: 10px;"><strong>📖 Temas trabajados:</strong> {{ activity.topics_worked|default:"-" }}</p>
            <p style="margin-bottom: 10px;"><strong>🎼 Técnicas:</strong> {{ activity.techniques|default:"-" }}</p>
            <p style="margin-bottom: 10px;"><strong>🎵 Repertorio:</strong> {{ activity.pieces|default:"-" }}</p>
            <p style="margin-bottom: 10px;"><strong>✨ Fortalezas:</strong> {{ activity.strengths|default:"-" }}</p>
            <p style="margin-bottom: 10px;"><strong>🎯 A mejorar:</strong> {{ activity.areas_to_improve|default:"-" }}</p>
            <p style="margin-bottom: 10px;"><strong>🏠 Tarea:</strong> {{ activity.homework|default:"Sin tareas" }}</p>
            <p><strong>⏱️ Tiempo de práctica:</strong> {{ activity.practice_time }} minutos/día</p>
        </div>
    </div>
    {% endfor %}
</div>
{% empty %}
<p style="color: #6B7280; text-align: center; padding: 60px;">No tienes clases registradas</p>
{% endfor %}
{% endblock %}
