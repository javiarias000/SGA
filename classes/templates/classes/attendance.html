{% extends 'classes/base.html' %}

{% block title %}Asistencia{% endblock %}
{% block page_title %}✅ Control de Asistencia{% endblock %}

{% block content %}
<div class="attendance-header">
    <h2>📅 Asistencia de Hoy - {% now "d/m/Y" %}</h2>
</div>

<!-- Botón para mostrar/ocultar -->
<button id="toggle-grade-form" class="btn btn-secondary">➕ Registrar Asistencia</button>

<!-- Div que contiene el formulario -->
<div class="add-grade-section" id="grade-form" style="display: none; margin-top: 10px;">
    <h3>➕ Registrar Asistencia</h3>
    <form method="post">
        {% csrf_token %}
        <div class="form-row">
            <div class="form-group">
                {{ form.student.label_tag }}
                {{ form.student }}
            </div>
            <div class="form-group">
                {{ form.date.label_tag }}
                {{ form.date }}
            </div>
            <div class="form-group">
                {{ form.status.label_tag }}
                {{ form.status }}
            </div>
        </div>
        
        <div class="form-group">
            {{ form.notes.label_tag }}
            {{ form.notes }}
        </div>
        
        <button type="submit" class="btn btn-primary">💾 Registrar Asistencia</button>
    </form>
</div>

<div class="attendance-list mt-20">
    <h3>Lista de Asistencia de Hoy</h3>
    {% if attendances %}
        <div class="attendance-grid">
            {% for attendance in attendances %}
            <div class="attendance-item attendance-{{ attendance.status|lower|slugify }}">
                <div class="attendance-student">
                    <div class="student-avatar-small">{{ attendance.student.name.0 }}</div>
                    <div>
                        <h4>{{ attendance.student.name }}</h4>
                        <p>{{ attendance.student.grade }}</p>
                    </div>
                </div>
                <div class="attendance-status">
                    <span class="status-badge status-{{ attendance.status|lower|slugify }}">
                        {% if attendance.status == 'Presente' %}✅
                        {% elif attendance.status == 'Ausente' %}❌
                        {% elif attendance.status == 'Tardanza' %}⏰
                        {% else %}📝{% endif %}
                        {{ attendance.status }}
                    </span>
                    {% if attendance.notes %}
                    <p class="attendance-note">{{ attendance.notes }}</p>
                    {% endif %}
                </div>
            </div>
            {% endfor %}
        </div>
    {% else %}
        <div class="empty-state">
            <h3>✅</h3>
            <h3>No hay asistencias registradas hoy</h3>
            <p>Comienza a registrar la asistencia de tus estudiantes</p>
        </div>
    {% endif %}
</div>

<script>
    const toggleBtn = document.getElementById('toggle-grade-form');
    const gradeForm = document.getElementById('grade-form');
    
    toggleBtn.addEventListener('click', () => {
        if (gradeForm.style.display === 'none') {
            gradeForm.style.display = 'block';
            toggleBtn.textContent = '❌ Ocultar Formulario';
        } else {
            gradeForm.style.display = 'none';
            toggleBtn.textContent = '➕ Registrar Calificación';
        }
    });
    </script>

<style>
.attendance-header {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    margin-bottom: 20px;
    text-align: center;
}

.add-attendance-section {
    background: linear-gradient(135deg, #DBEAFE 0%, #BFDBFE 100%);
    padding: 25px;
    border-radius: 15px;
    margin-bottom: 30px;
}

.attendance-grid {
    display: grid;
    gap: 15px;
}

.attendance-item {
    background: white;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    display: flex;
    justify-content: space-between;
    align-items: center;
    border-left: 5px solid;
}

.attendance-item.attendance-presente {
    border-left-color: #10B981;
}

.attendance-item.attendance-ausente {
    border-left-color: #EF4444;
}

.attendance-item.attendance-tardanza {
    border-left-color: #F59E0B;
}

.attendance-item.attendance-justificado {
    border-left-color: #3B82F6;
}

.attendance-student {
    display: flex;
    align-items: center;
    gap: 15px;
}

.student-avatar-small {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-weight: bold;
}

.attendance-student h4 {
    margin-bottom: 3px;
}

.attendance-student p {
    color: #6B7280;
    font-size: 14px;
}

.attendance-status {
    text-align: right;
}

.status-badge {
    padding: 8px 15px;
    border-radius: 20px;
    font-weight: bold;
    font-size: 14px;
}

.status-presente {
    background: #D1FAE5;
    color: #065F46;
}

.status-ausente {
    background: #FEE2E2;
    color: #991B1B;
}

.status-tardanza {
    background: #FEF3C7;
    color: #92400E;
}

.status-justificado {
    background: #DBEAFE;
    color: #1E40AF;
}

.attendance-note {
    margin-top: 8px;
    font-size: 13px;
    color: #6B7280;
    font-style: italic;
}

@media (max-width: 768px) {
    .attendance-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
    }
    
    .attendance-status {
        text-align: left;
        width: 100%;
    }
}
</style>
{% endblock %}
